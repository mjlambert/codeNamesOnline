'use strict';

//==============================================================================
//  Modules
//==============================================================================

var Game              = require('codeNamesOnline/game');
var wordGridGenerator = require('codeNamesOnline/wordGridGenerator');

//==============================================================================
//  Games
//==============================================================================

var CurrentGames = [];

//==============================================================================
//  Exports
//==============================================================================

module.exports.CreateNewGame = function (socket, callback) {
	var gameCode = GenerateGameCode();
	wordGridGenerator.generateWordGrid(function (error, wordGrid) {
		if (error) {
			return callback(error);
		}
		else {
			var newGame = new Game(gameCode, wordGrid, socket);
			return callback(null, newGame);
		}
	});
}

//==============================================================================
//  Private functions
//==============================================================================

function GenerateGameCode() {

	var gameCode;
	var possible = 'abcdefghijklmnopqrstuvwxyz';

	do {
		gameCode = '';
		for (var i = 0; i < 4; i++) {
			gameCode += possible.charAt(Math.floor(Math.random() * possible.length));
		}
	} while(!isUniqueGameCode(gameCode));

	return gameCode;
}

function isUniqueGameCode(gameCode) {
	for (var i = 0; i < CurrentGames.length; i++) {
		if (gameCode === CurrentGames[i].GetGameCode()) {
			return false;
		}
	}
	return false;
}
