'use strict';

//==============================================================================
//  Modules
//==============================================================================

var gameAPI = require('codeNamesOnline/api/gameAPI');

//==============================================================================
//  Exports
//==============================================================================

module.exports = function (app) {

	// API routes

	app.post('/api/createNewGame', function (request, response) {
		var socketId = request.query.socketId;
		gameAPI.CreateNewGame(socketId, function (error, gameCode) {
			var result;
			if (error) {
				result = {
					success : false,
					error   : error.message
				};
			}
			else {
				result = {
					success : true,
					data    : gameCode
				};
			}
			response.json(result);
		});
	});

	app.get('/api/game/:gameCode', function (request, response) {
		var gameCode = request.params.gameCode;
		gameAPI.GetGameData(gameCode, function (error, gameData) {
			var result;
			if (error) {
				result = {
					success : false,
					error   : error.message
				};
			}
			else {
				result = {
					success : true,
					data    : gameData
				};
			}
			response.json(result);
		});
	});

	app.post('/api/game/:gameCode/addPlayer', function (request, response) {
		var gameCode = request.params.gameCode;
		var playerData = request.query.playerData;
		var socketId = request.query.socketId;
		gameAPI.AddPlayer(gameCode, playerData, socketId, function (error) {
			var result;
			if (error) {
				result = {
					success : false,
					error   : error.message
				};
			}
			else {
				result = {
					success : true
				};
			}
			response.json(result);
		});
	});

	app.put('/api/game/:gameCode/selectWord', function (request, response) {
		var gameCode = request.params.gameCode;
		var word = request.query.word;
		gameAPI.SelectWord(gameCode, word, function (error) {
			var result;
			if (error) {
				result = {
					success : false,
					error   : error.message
				};
			}
			else {
				result = {
					success : true
				};
			}
			response.json(result);
		});
	});

	// Front end routes

	app.get('*', function (request, response) {
		response.sendFile('index.html', {'root' : './public'});
	});
};
